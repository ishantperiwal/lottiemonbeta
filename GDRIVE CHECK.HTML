<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Lottie File Inspector</title>
    <!-- Load Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Load Inter font -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Inter', sans-serif;
        }
        /* Simple tab styling */
        .tab-btn {
            @apply px-4 py-2 font-medium text-sm rounded-md transition-colors;
        }
        .tab-btn.active {
            @apply bg-blue-600 text-white;
        }
        .tab-btn.inactive {
            @apply text-gray-400 hover:bg-gray-700 hover:text-gray-200;
        }
        .tab-content {
            display: none;
        }
        .tab-content.active {
            display: block;
        }
    </style>
</head>
<body class="bg-gray-900 text-gray-200 flex items-center justify-center min-h-screen p-4">

    <div class="w-full max-w-2xl bg-gray-800 rounded-lg shadow-2xl p-6 md:p-8">
        <h1 class="text-2xl font-bold text-center text-white mb-6">
            Lottie File Inspector
        </h1>

        <!-- Input Section -->
        <div class="space-y-4">
            <div>
                <label for="file-upload" class="block text-sm font-medium text-gray-300 mb-2">
                    1. Upload .lottie file (Recommended)
                </label>
                <input id="file-upload" type="file" accept=".json,.lottie" class="block w-full text-sm text-gray-400 file:mr-4 file:py-2 file:px-4 file:rounded-md file:border-0 file:text-sm file:font-semibold file:bg-blue-600 file:text-white hover:file:bg-blue-700 transition cursor-pointer">
                <p class="text-xs text-gray-500 mt-1">This is the most reliable method.</p>
            </div>

            <div class="text-center text-sm font-semibold text-gray-500">OR</div>

            <div>
                <label for="gdrive-link" class="block text-sm font-medium text-gray-300 mb-2">
                    2. Paste Google Drive Share Link
                </label>
                <input id="gdrive-link" type="text" placeholder="https://drive.google.com/file/d/..." class="w-full px-3 py-2 bg-gray-700 border border-gray-600 rounded-md text-gray-200 placeholder-gray-500 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500">
                <p class="text-xs text-yellow-400 mt-1">
                    <span class="font-bold">Warning:</span> This will likely fail due to browser security (CORS) policy. Use the upload option if possible.
                </p>
            </div>
        </div>

        <!-- Action Button -->
        <button id="inspect-btn" class="w-full bg-green-600 text-white font-semibold py-2 px-4 rounded-md hover:bg-green-700 transition-colors duration-200 mt-6">
            Inspect Lottie
        </button>

        <!-- Message Area -->
        <div id="message-area" class="mt-4 text-center text-sm"></div>

        <!-- Output Section -->
        <div id="output-container" class="mt-6 hidden">
            <!-- Tabs -->
            <div class="border-b border-gray-700 mb-4">
                <nav class="flex space-x-2" aria-label="Tabs">
                    <button id="tab-report" class="tab-btn active">Structure Report</button>
                    <button id="tab-json" class="tab-btn inactive">Full JSON</button>
                </nav>
            </div>

            <!-- Tab Content -->
            <div>
                <div id="content-report" class="tab-content active">
                    <pre class="bg-gray-950 p-4 rounded-md overflow-auto text-sm text-green-300 max-h-[400px]"><code></code></pre>
                </div>
                <div id="content-json" class="tab-content">
                    <pre class="bg-gray-950 p-4 rounded-md overflow-auto text-sm text-gray-300 max-h-[400px]"><code></code></pre>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Get DOM elements
        const fileInput = document.getElementById('file-upload');
        const linkInput = document.getElementById('gdrive-link');
        const inspectBtn = document.getElementById('inspect-btn');
        const messageArea = document.getElementById('message-area');
        const outputContainer = document.getElementById('output-container');
        
        const tabReportBtn = document.getElementById('tab-report');
        const tabJsonBtn = document.getElementById('tab-json');
        const contentReport = document.getElementById('content-report');
        const contentJson = document.getElementById('content-json');
        const reportCode = contentReport.querySelector('code');
        const jsonCode = contentJson.querySelector('code');

        // Add button click listener
        inspectBtn.addEventListener('click', handleInspect);

        // Add tab click listeners
        tabReportBtn.addEventListener('click', () => switchTab('report'));
        tabJsonBtn.addEventListener('click', () => switchTab('json'));

        function switchTab(tab) {
            if (tab === 'report') {
                tabReportBtn.classList.replace('inactive', 'active');
                tabJsonBtn.classList.replace('active', 'inactive');
                contentReport.classList.add('active');
                contentJson.classList.remove('active');
            } else {
                tabReportBtn.classList.replace('active', 'inactive');
                tabJsonBtn.classList.replace('inactive', 'active');
                contentReport.classList.remove('active');
                contentJson.classList.add('active');
            }
        }

        function handleInspect() {
            // Clear previous state
            showMessage('');
            outputContainer.classList.add('hidden');
            reportCode.textContent = '';
            jsonCode.textContent = '';

            const file = fileInput.files[0];
            const link = linkInput.value.trim();

            if (file) {
                // Priority 1: Use file upload
                showMessage('Reading file...', 'loading');
                const reader = new FileReader();
                reader.onload = (e) => {
                    processLottieData(e.target.result);
                };
                reader.onerror = () => {
                    showMessage('Error reading file.', 'error');
                };
                reader.readAsText(file);
            } else if (link) {
                // Priority 2: Use GDrive link
                handleGDriveLink(link);
            } else {
                showMessage('Please upload a file or paste a link.', 'error');
            }
        }

        async function handleGDriveLink(url) {
            showMessage('Attempting to fetch from Google Drive... (This often fails due to CORS)', 'loading');
            
            // Regex to extract file ID from various GDrive link formats
            const fileIdMatch = url.match(/\/file\/d\/([a-zA-Z0-9_-]+)/);
            if (!fileIdMatch || !fileIdMatch[1]) {
                showMessage('Invalid Google Drive link format. Could not find file ID.', 'error');
                return;
            }
            
            const fileId = fileIdMatch[1];
            const directUrl = `https://drive.google.com/uc?export=download&id=${fileId}`;
            
            // Use a CORS proxy to bypass browser security. This is not 100% reliable.
            // Using allorigins.win as an example proxy
            const proxyUrl = `https://api.allorigins.win/raw?url=${encodeURIComponent(directUrl)}`;

            try {
                const response = await fetch(proxyUrl);
                if (!response.ok) {
                    throw new Error(`Fetch failed with status: ${response.status}`);
                }
                const text = await response.text();
                processLottieData(text);
            } catch (error) {
                console.error('Fetch Error:', error);
                showMessage('Failed to fetch file. This is likely a CORS security block. Please use the file upload method instead.', 'error');
            }
        }

        function processLottieData(text) {
            try {
                const jsonData = JSON.parse(text);
                showMessage('File processed successfully!', 'success');
                
                // 1. Generate and display the structure report
                const report = generateStructureReport(jsonData);
                reportCode.textContent = JSON.stringify(report, null, 2);

                // 2. Display the full JSON
                jsonCode.textContent = JSON.stringify(jsonData, null, 2);
                
                // Show output and default to report tab
                outputContainer.classList.remove('hidden');
                switchTab('report');

            } catch (error) {
                console.error('JSON Parse Error:', error);
                showMessage('Failed to parse JSON. The file may be corrupt, not a JSON Lottie, or a compressed (zipped) .lottie file, which is not supported.', 'error');
            }
        }

        function generateStructureReport(json) {
            const report = {};

            // Extract metadata
            report.metadata = {
                lottie_version: json.v || 'Unknown',
                frame_rate: json.fr || 'Unknown',
                width: json.w || 'Unknown',
                height: json.h || 'Unknown',
                animation_name: json.nm || 'Untitled',
            };
            
            // Extract "Folder Structure" from assets
            if (json.assets && json.assets.length > 0) {
                report.assets_structure = json.assets.map(asset => {
                    if (asset.p && asset.p.startsWith('data:')) {
                        // Embedded asset
                        return {
                            id: asset.id,
                            type: 'Embedded Base64 Data',
                            filename: `(embedded_image_${asset.id})`
                        };
                    } else if (asset.u || asset.p) {
                        // Linked asset - this is the "folder structure"
                        const path = (asset.u || ''); // 'u' is the folder path
                        const filename = (asset.p || ''); // 'p' is the filename
                        return {
                            id: asset.id,
                            type: 'Linked Asset',
                            path: path,
                            filename: filename,
                            full_path: `${path}${filename}`
                        };
                    }
                    return { id: asset.id, type: 'Unknown Asset Format' };
                });
            } else {
                report.assets_structure = 'No assets found in this file.';
            }

            // Extract layer info
            if (json.layers && json.layers.length > 0) {
                report.layers = {
                    count: json.layers.length,
                    names: json.layers.map(layer => layer.nm || 'Unnamed Layer')
                };
            } else {
                report.layers = 'No layers found.';
            }

            return report;
        }

        function showMessage(text, type = 'info') {
            messageArea.textContent = text;
            messageArea.classList.remove('text-green-400', 'text-red-400', 'text-yellow-400', 'text-gray-400');
            
            switch (type) {
                case 'success':
                    messageArea.classList.add('text-green-400');
                    break;
                case 'error':
                    messageArea.classList.add('text-red-400');
                    break;
                case 'loading':
                    messageArea.classList.add('text-yellow-400');
                    break;
                default:
                    messageArea.classList.add('text-gray-400');
            }
        }
    </script>

</body>
</html>
